<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
							"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.wapl.app.common.dao.MemberDAO">


	<sql id="criteria">
		<trim prefix="(" suffix=") AND " prefixOverrides="OR">
			<foreach item="type" collection="typeArr">
				<trim prefix="OR">
					<choose>
						<when test="type=='T'.toString()">
							title like '%'||#{keyword}||'%'
						</when>
						<when test="type=='C'.toString()">
							content like '%'||#{keyword}||'%'
						</when>
						<when test="type=='W'.toString()">
							writer like '%'||#{keyword}||'%'
						</when>
					</choose>
				</trim>
			</foreach>
		</trim>
	</sql>
	<insert id="insertMember" parameterType="MemberVO">
		SELECT mno
			,current_pno
			,finished_pno
			,id
			,pwd
			,age
			,sex
			,email
			,tel
			,reg_date regDate
			,update_date updateDate
		  FROM TBL_MEMBER 
		 WHERE mno = #{mno}
	</insert>
	
	<select id="selectMemberList" resultType="MemberVO">
		SELECT mno
			,current_pno as currentPno
			,finished_pno as finishedPno
			,id
			,pwd
			,age
			,sex
			,email
			,tel
			,mem_level as memLevel
			,nickname
			,position1
			,position2
			,position1_level as position1Level 
			,position2_level as position2Level
			,reg_date 
			,update_date
		  FROM TBL_MEMBER 
		  where
		   <include refid="criteria"></include>
	      
	      <![CDATA[
	      rownum <= #{pageNum} * #{amount}
	      )
	      where rn > (#{pageNum} - 1) * #{amount}
	 		 ]]>

	</select>
	<update id="updateMember">
		UPDATE TBL_MEMBER 
		   SET mno = #{mno}
			,current_pno = #{currentPno}
			,finished_pno = #{finishedPno}
			,id = #{id}
			,pwd = #{pwd}
			,age = #{age}
			,sex = #{sex}
			,email = #{email}
			,tel = #{tel}
			,level = #{level}
			,position1 = #{position1}
			,position2 = #{position2}
			,position1_level = #{position1Level}
			,position2_level = #{position2Level}
			,nickname = #{nickname}
			,reg_date = #{regDate}
			,update_date = #{updateDate}
		 WHERE mno = #{mno}

	</update>
	
	<delete id="deleteMember">
		DELETE FROM TBL_MEMBER 
		 WHERE mno = #{mno}

	</delete>
	<select id="selectMemberListTotalCount" resultType="int">
	 select count(*) from tbl_member 
	 where 
	 
	 
	 mno > 0
	</select>
	
	
</mapper>